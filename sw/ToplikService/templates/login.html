<!doctype html>
<html lang="hr" data-theme="dark"> <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    
    <title>Dobrodošli</title>
    
    <style>
      /* --- (Stilovi ostaju isti) --- */
      body, html {
        height: 100%;
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      }
      body {
        background-image: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url('https://source.unsplash.com/random/1600x900/?resort,pool');
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
        display: grid;
        place-items: center;
      }
      article {
        max-width: 380px;
        width: 100%;
        padding: 2rem;
        border-radius: 1rem;
        background-color: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      h1 {
        text-align: center;
        color: white;
      }
      input[type="password"] {
        text-align: center;
        font-size: 1.5rem;
        letter-spacing: 0.2em;
      }
    </style>
  </head>
  
  <body>
    <main>
      <article>
        <h1>Dobrodošli</h1>
        
        <form id="loginForma">
          <label for="pin">Molimo, unesite vaš PIN</label>
          <input 
            type="password" 
            id="pin" 
            name="pin" 
            placeholder="••••" 
            required
            pattern="\d*"      
            inputmode="numeric"
            autocomplete="new-password" >
          
          <button type="submit" style="width: 100%;">Pristupi</button>
        </form>
        
      </article>
    </main>
    
   <script>
      // --------------------------------------------------------
      // NOVI I KOMPLETAN JAVASCRIPT ZA LOGIN.HTML
      // --------------------------------------------------------

      // AŽURIRANO 2: Osiguraj da je polje prazno kod učitavanja,
      // bez obzira na cache browsera.
      document.addEventListener('DOMContentLoaded', function() {
        const pinInput = document.getElementById('pin');
        if (pinInput) {
          pinInput.value = ''; // Očisti polje
        }
      });

      document.getElementById('loginForma').addEventListener('submit', function(event) {
        event.preventDefault(); // Spriječi da stranica odradi "refresh"
        
        const pin = document.getElementById('pin').value;
        const button = event.target.querySelector('button');
        const originalButtonText = button.textContent;

        // Onemogući dugme dok traje provjera
        button.disabled = true;
        button.textContent = 'Provjeravam...';

        // Šalji PIN našem Python serveru na /api/login
        fetch('/api/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ pin: pin }), // Šaljemo JSON: {"pin": "VAŠ_PIN"}
        })
        .then(response => {
            if (response.ok) {
                return response.json(); 
            } else {
                return response.json().then(err => { 
                    throw new Error(err.message || 'Pogrešan PIN'); 
                });
            }
        })
        .then(data => {
            if (data.success) {
                window.location.href = '/soba';
            } else {
                alert(data.message || 'Došlo je do greške.');
                button.disabled = false;
                button.textContent = originalButtonText;
            }
        })
        .catch(error => {
            console.error('Greška pri prijavi:', error);
            alert(error.message || 'Nije moguće provjeriti PIN.');
            button.disabled = false;
            button.textContent = originalButtonText;
        });
      });
    </script>
  </body>
</html>